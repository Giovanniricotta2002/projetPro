openapi: 3.0.0
info:
  title: 'API ProjetPro'
  description: "API REST pour l'application ProjetPro avec système d'authentification sécurisé.\n\n## Fonctionnalités principales:\n- Authentification avec protection anti-force brute\n- Gestion des tokens CSRF\n- Upload d'images vers Azure Blob Storage\n- Logging automatique des tentatives de connexion\n- Système de blocage par IP et par login\n\n## Sécurité:\n- Protection CSRF obligatoire\n- Tokens d'authentification JWT\n- Blocage automatique après échecs répétés\n\n## Headers requis:\n- `X-CSRF-Token`: Token CSRF pour les requêtes POST\n- `Authorization: Bearer <token>`: Token JWT pour l'authentification\n- `Content-Type: application/json`\n"
  contact:
    name: 'Support API'
    email: support@projetpro.com
  version: 1.0.0
servers:
  -
    url: 'http://localhost:8000'
    description: 'Serveur de développement'
  -
    url: /api
    description: 'API Production'
paths:
  /api/csrfToken:
    get:
      tags:
        - 'CSRF Token'
      summary: 'Générer un token CSRF'
      description: "Génère un nouveau token CSRF pour sécuriser les formulaires de l'application"
      operationId: generateCsrfToken
      responses:
        '200':
          description: 'Token CSRF généré avec succès'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CsrfTokenResponseDTO'
        '500':
          description: 'Erreur serveur lors de la génération du token'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseDTO'
    options:
      tags:
        - 'CSRF Token'
      summary: 'Options pour le token CSRF'
      description: "Retourne les options disponibles pour l'endpoint de génération de token CSRF"
      operationId: optionsCsrfToken
      responses:
        '200':
          description: 'Token CSRF généré avec succès'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CsrfTokenResponseDTO'
        '500':
          description: 'Erreur serveur lors de la génération du token'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseDTO'
  /api/csrfToken/verify:
    post:
      tags:
        - 'CSRF Token'
      summary: 'Vérifier un token CSRF'
      description: "Vérifie la validité d'un token CSRF fourni par le client"
      operationId: verifyCsrfToken
      requestBody:
        description: 'Token CSRF à vérifier'
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CsrfTokenVerificationRequestDTO'
      responses:
        '200':
          description: 'Token CSRF valide'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CsrfTokenVerificationResponseDTO'
        '400':
          description: 'Token CSRF manquant ou format invalide'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseDTO'
        '403':
          description: 'Token CSRF invalide'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseDTO'
        '422':
          description: 'Erreurs de validation des données'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseDTO'
  /api/categorie-forum/:
    get:
      tags:
        - CategorieForum
      summary: 'Liste des catégories de forum'
      description: 'Retourne la liste des catégories de forum'
      operationId: get_app_categorie_forum_load
      responses:
        '200':
          description: 'Liste des catégories'
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CategorieForumResponseDTO'
  /api/forum/:
    get:
      tags:
        - Forum
      summary: 'Liste des forums'
      description: 'Retourne la liste des forums'
      operationId: get_app_forum_forum
      responses:
        '200':
          description: 'Liste des forums'
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ForumResponseDTO'
    post:
      tags:
        - Forum
      summary: 'Créer un forum'
      description: 'Crée un nouveau forum'
      operationId: post_app_forum_create_forum
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ForumCreateRequestDTO'
      responses:
        '200':
          description: 'Forum créé'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ForumResponseDTO'
        '400':
          description: 'Erreur de validation'
          content:
            application/json:
              schema:
                properties:
                  success: { type: boolean }
                  message: { type: string }
                type: object
  '/api/forum/{forum}':
    delete:
      tags:
        - Forum
      summary: 'Supprimer un forum'
      description: 'Supprime un forum par son ID'
      operationId: delete_app_forum_delete_forum
      parameters:
        -
          name: forum
          in: path
          description: 'ID du forum'
          required: true
          schema:
            type: integer
            pattern: '\d*'
      responses:
        '200':
          description: 'Forum supprimé'
          content:
            application/json:
              schema:
                properties:
                  success: { type: boolean, example: true }
                type: object
  /api/health:
    get:
      tags:
        - Health
      summary: "Vérifie la santé de l'API"
      description: "Retourne le statut de santé du backend, la base de données, l'environnement et l'espace disque."
      operationId: get_health_check
      responses:
        '200':
          description: 'Statut de santé OK'
          content:
            application/json:
              schema:
                properties:
                  status: { type: string, example: healthy }
                  timestamp: { type: string, example: '2025-08-11T12:34:56+00:00' }
                  service: { type: string, example: 'MuscuScope Backend' }
                  version: { type: string, example: 1.0.0 }
                  database: { type: string, example: connected }
                  environment: { type: string, example: dev }
                  disk_usage: { properties: { free: { type: integer, example: 123456789 }, total: { type: integer, example: 987654321 }, percentage_used: { type: number, format: float, example: 12.34 } }, type: object }
                type: object
        '503':
          description: 'Base de données inaccessible'
          content:
            application/json:
              schema:
                properties:
                  status: { type: string, example: unhealthy }
                  error: { type: string, example: 'SQLSTATE[HY000] ...' }
                type: object
  /api/images/upload-url:
    post:
      tags:
        - Images
      summary: "Générer une URL d'upload Azure"
      description: 'Génère une URL présignée pour uploader directement une image vers Azure Blob Storage'
      operationId: generateImageUploadUrl
      requestBody:
        description: 'Informations de fichier à uploader'
        required: true
        content:
          application/json:
            schema:
              required:
                - filename
              properties:
                filename:
                  description: 'Nom du fichier avec extension'
                  type: string
                  example: photo.jpg
                expiry:
                  description: 'Durée de validité en secondes'
                  type: integer
                  example: 3600
              type: object
      responses:
        '200':
          description: "URL d'upload générée avec succès"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AzureUploadResponseDTO'
        '400':
          description: 'Paramètres invalides ou extension non autorisée'
  /api/images/verify:
    post:
      tags:
        - Images
      summary: "Vérifier un upload d'image"
      description: "Vérifie qu'un upload a bien eu lieu sur Azure Blob Storage et retourne l'URL publique de l'image."
      operationId: verifyImageUpload
      requestBody:
        description: 'Nom du blob à vérifier'
        required: true
        content:
          application/json:
            schema:
              required:
                - blob_name
              properties:
                blob_name:
                  description: 'Nom du blob/image'
                  type: string
                  example: photo.jpg
              type: object
      responses:
        '200':
          description: 'Image trouvée, URL retournée'
          content:
            application/json:
              schema:
                properties:
                  success: { type: boolean, example: true }
                  image_url: { type: string, example: 'https://storageaccount.blob.core.windows.net/container/photo.jpg' }
                  blob_name: { type: string, example: photo.jpg }
                type: object
        '400':
          description: 'Paramètre blob_name manquant'
          content:
            application/json:
              schema:
                properties:
                  error: { type: string, example: 'blob_name is required' }
                type: object
        '404':
          description: 'Image non trouvée ou upload échoué'
          content:
            application/json:
              schema:
                properties:
                  success: { type: boolean, example: false }
                  error: { type: string, example: 'Image not found or upload failed' }
                type: object
  '/api/images/signed-url/{blobName}':
    get:
      tags:
        - Images
      summary: 'Obtenir une URL signée pour une image privée'
      description: 'Génère une URL temporaire signée pour accéder à une image privée sur Azure Blob Storage.'
      operationId: getSignedImageUrl
      parameters:
        -
          name: blobName
          in: path
          description: 'Nom du blob/image'
          required: true
          schema:
            type: string
            example: photo.jpg
        -
          name: expiry
          in: query
          description: "Durée de validité de l'URL en secondes"
          required: false
          schema:
            type: integer
            example: 3600
      responses:
        '200':
          description: 'URL signée générée'
          content:
            application/json:
              schema:
                properties:
                  signed_url: { type: string, example: 'https://...' }
                  expires_at: { type: string, example: '2025-08-11T13:00:00Z' }
                type: object
        '500':
          description: "Erreur lors de la génération de l'URL"
          content:
            application/json:
              schema:
                properties:
                  error: { type: string, example: 'Failed to generate signed URL' }
                  message: { type: string, example: ... }
                type: object
  '/api/images/{blobName}':
    delete:
      tags:
        - Images
      summary: 'Supprimer une image'
      description: "Supprime une image d'Azure Blob Storage."
      operationId: deleteImage
      parameters:
        -
          name: blobName
          in: path
          description: 'Nom du blob/image à supprimer'
          required: true
          schema:
            type: string
            example: photo.jpg
      responses:
        '200':
          description: 'Image supprimée'
          content:
            application/json:
              schema:
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string, example: 'Image deleted successfully' }
                type: object
        '404':
          description: 'Image non trouvée'
          content:
            application/json:
              schema:
                properties:
                  success: { type: boolean, example: false }
                  error: { type: string, example: 'Failed to delete image' }
                type: object
        '500':
          description: 'Erreur serveur'
          content:
            application/json:
              schema:
                properties:
                  error: { type: string, example: 'Failed to delete image' }
                  message: { type: string, example: ... }
                type: object
  '/api/images/url/{blobName}':
    get:
      tags:
        - Images
      summary: "Obtenir l'URL publique d'une image"
      description: "Retourne l'URL publique d'une image stockée sur Azure Blob Storage."
      operationId: getPublicImageUrl
      parameters:
        -
          name: blobName
          in: path
          description: 'Nom du blob/image'
          required: true
          schema:
            type: string
            example: photo.jpg
      responses:
        '200':
          description: 'URL publique retournée'
          content:
            application/json:
              schema:
                properties:
                  image_url: { type: string, example: 'https://storageaccount.blob.core.windows.net/container/photo.jpg' }
                  blob_name: { type: string, example: photo.jpg }
                type: object
  /api/login:
    post:
      tags:
        - Authentication
      summary: 'Authentifier un utilisateur'
      description: 'Authentifie un utilisateur avec son login et mot de passe. Inclut une protection contre les attaques par force brute.'
      operationId: authenticateUser
      requestBody:
        description: 'Identifiants de connexion utilisateur'
        required: true
        content:
          application/json:
            schema:
              required:
                - login
                - password
              properties:
                login:
                  description: "Nom d'utilisateur ou adresse email"
                  type: string
                  example: john.doe
                password:
                  description: "Mot de passe de l'utilisateur"
                  type: string
                  format: password
                  example: motDePasseSecret123
              type: object
      responses:
        '200':
          description: 'Connexion réussie avec tokens JWT'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JWTLoginResponseDTO'
        '401':
          description: 'Identifiants incorrects'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseDTO'
        '429':
          description: 'Trop de tentatives - Protection anti-brute force'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseDTO'
      security:
        -
          csrfToken: []
    options:
      tags:
        - Authentication
      summary: "Options pour l'authentification utilisateur"
      description: "Retourne les options disponibles pour l'authentification utilisateur (CORS, headers, etc)."
      operationId: loginOptions
      responses:
        '200':
          description: 'Options retournées'
          content:
            application/json:
              schema:
                properties:
                  Access-Control-Allow-Origin: { type: string, example: '*' }
                  Access-Control-Allow-Methods: { type: string, example: 'POST, OPTIONS' }
                  Access-Control-Allow-Headers: { type: string, example: 'Content-Type, X-CSRF-Token' }
                type: object
  /api/register:
    post:
      tags:
        - Authentication
      summary: 'Inscrire un nouvel utilisateur'
      description: "Crée un nouvel utilisateur avec un login et un mot de passe. Vérifie la validité et l'unicité du login."
      operationId: registerUser
      requestBody:
        description: "Identifiants pour l'inscription"
        required: true
        content:
          application/json:
            schema:
              required:
                - username
                - password
              properties:
                username:
                  description: "Nom d'utilisateur"
                  type: string
                  example: john.doe
                password:
                  description: 'Mot de passe'
                  type: string
                  format: password
                  example: motDePasseSecret123
              type: object
      responses:
        '201':
          description: 'Utilisateur inscrit avec succès'
          content:
            application/json:
              schema:
                properties:
                  message: { type: string, example: 'User registered successfully' }
                type: object
        '400':
          description: 'Paramètres invalides ou manquants'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseDTO'
        '409':
          description: "Nom d'utilisateur déjà existant"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseDTO'
        '500':
          description: 'Erreur serveur'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseDTO'
  /api/logout:
    post:
      operationId: post_app_login_logout
      responses:
        default:
          description: ''
  /api/admin/login-logs/statistics:
    get:
      tags:
        - 'Admin Login Logs'
      summary: 'Statistiques de connexion'
      description: 'Récupère les statistiques de connexion pour une période donnée (paramètres from/to au format Y-m-d ou Y-m-d H:i:s).'
      operationId: getLoginStatistics
      parameters:
        -
          name: from
          in: query
          description: 'Date de début'
          required: false
          schema:
            type: string
            example: '2025-08-01'
        -
          name: to
          in: query
          description: 'Date de fin'
          required: false
          schema:
            type: string
            example: '2025-08-11'
      responses:
        '200':
          description: 'Statistiques retournées'
          content:
            application/json:
              schema:
                properties:
                  success: { type: boolean, example: true }
                  period: { type: object }
                  statistics: { type: array, items: { type: object } }
                type: object
        '500':
          description: 'Erreur serveur'
  '/api/admin/login-logs/check-ip-status/{ip}':
    get:
      tags:
        - 'Admin Login Logs'
      summary: 'Vérifier le statut de blocage IP'
      description: "Vérifie si une IP est actuellement bloquée et retourne le nombre d'échecs récents."
      operationId: checkIpStatus
      parameters:
        -
          name: ip
          in: path
          description: 'Adresse IP à vérifier'
          required: true
          schema:
            type: string
            example: 192.168.1.1
      responses:
        '200':
          description: 'Statut IP retourné'
          content:
            application/json:
              schema:
                properties:
                  success: { type: boolean, example: true }
                  ip: { type: string, example: 192.168.1.1 }
                  is_blocked: { type: boolean, example: false }
                  recent_failed_attempts: { type: integer, example: 2 }
                  status: { type: string, example: allowed }
                type: object
        '500':
          description: 'Erreur serveur'
  '/api/admin/login-logs/check-login-status/{login}':
    get:
      tags:
        - 'Admin Login Logs'
      summary: 'Vérifier le statut de blocage login'
      description: "Vérifie si un login est actuellement bloqué et retourne le nombre d'échecs récents."
      operationId: checkLoginStatus
      parameters:
        -
          name: login
          in: path
          description: 'Login à vérifier'
          required: true
          schema:
            type: string
            example: john.doe
      responses:
        '200':
          description: 'Statut login retourné'
          content:
            application/json:
              schema:
                properties:
                  success: { type: boolean, example: true }
                  login: { type: string, example: john.doe }
                  is_blocked: { type: boolean, example: false }
                  recent_failed_attempts: { type: integer, example: 1 }
                  status: { type: string, example: allowed }
                type: object
        '500':
          description: 'Erreur serveur'
  /api/admin/login-logs/real-time-stats:
    get:
      tags:
        - 'Admin Login Logs'
      summary: 'Statistiques de connexion en temps réel'
      description: 'Retourne les statistiques de connexion pour la dernière heure, 24h et semaine.'
      operationId: getRealTimeLoginStats
      responses:
        '200':
          description: 'Statistiques temps réel retournées'
          content:
            application/json:
              schema:
                properties:
                  success: { type: boolean, example: true }
                  timestamp: { type: string, example: '2025-08-11 14:00:00' }
                  statistics: { type: object }
                type: object
        '500':
          description: 'Erreur serveur'
  '/api/admin/login-logs/unblock-ip/{ip}':
    post:
      tags:
        - 'Admin Login Logs'
      summary: 'Débloquer une IP'
      description: 'Réinitialise les tentatives échouées pour une IP (fonctionnalité non implémentée).'
      operationId: unblockIp
      parameters:
        -
          name: ip
          in: path
          description: 'Adresse IP à débloquer'
          required: true
          schema:
            type: string
            example: 192.168.1.1
      responses:
        '501':
          description: 'Fonctionnalité non implémentée'
          content:
            application/json:
              schema:
                properties:
                  success: { type: boolean, example: false }
                  message: { type: string, example: 'IP unblocking feature not yet implemented' }
                  suggestion: { type: string, example: 'This would require additional database logic to clear recent failed attempts' }
                type: object
  '/api/admin/login-logs/unblock-login/{login}':
    post:
      tags:
        - 'Admin Login Logs'
      summary: 'Débloquer un login'
      description: 'Réinitialise les tentatives échouées pour un login (fonctionnalité non implémentée).'
      operationId: unblockLogin
      parameters:
        -
          name: login
          in: path
          description: 'Login à débloquer'
          required: true
          schema:
            type: string
            example: john.doe
      responses:
        '501':
          description: 'Fonctionnalité non implémentée'
          content:
            application/json:
              schema:
                properties:
                  success: { type: boolean, example: false }
                  message: { type: string, example: 'Login unblocking feature not yet implemented' }
                  suggestion: { type: string, example: 'This would require additional database logic to clear recent failed attempts' }
                type: object
  /api/machines/:
    get:
      tags:
        - Machine
      summary: 'Liste des machines'
      description: 'Retourne la liste de toutes les machines'
      operationId: get_app_machines_all_machines
      responses:
        '200':
          description: 'Liste des machines'
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/MachineResponseDTO'
    post:
      tags:
        - Machine
      summary: 'Créer une machine'
      operationId: post_app_machines_create_machine
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MachineCreateRequestDTO'
      responses:
        '201':
          description: 'Machine créée'
        '400':
          description: 'Erreur de validation'
  '/api/machines/{materielId}':
    get:
      tags:
        - Machine
      summary: 'Récupérer une machine'
      description: "Retourne les informations d'une machine par son ID"
      operationId: get_app_machines_machine_by_id
      parameters:
        -
          name: materielId
          in: path
          description: 'ID de la machine'
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: 'Données de la machine'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MachineResponseDTO'
    put:
      tags:
        - Machine
      summary: 'Mettre à jour une machine'
      description: 'Met à jour une machine existante'
      operationId: put_app_machines_update_machine
      parameters:
        -
          name: materielId
          in: path
          description: 'ID de la machine'
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MachineUpdateRequestDTO'
      responses:
        '200':
          description: 'Machine mise à jour'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MachineResponseDTO'
        '400':
          description: 'Erreur de validation'
          content:
            application/json:
              schema:
                properties:
                  success: { type: boolean }
                  message: { type: string }
                type: object
        '404':
          description: 'Erreur lors de la mise à jour'
          content:
            application/json:
              schema:
                properties:
                  error: { type: string }
                type: object
  '/api/messages/{post}':
    get:
      tags:
        - Message
      summary: "Liste des messages d'un post"
      description: 'Retourne la liste des messages pour un post donné'
      operationId: get_app_messages_load
      parameters:
        -
          name: post
          in: path
          description: 'ID du post'
          required: true
          schema:
            type: integer
            pattern: '\d*'
      responses:
        '200':
          description: 'Liste des messages'
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/MessageResponseDTO'
    post:
      tags:
        - Message
      summary: 'Créer un message'
      description: 'Crée un message pour un post donné'
      operationId: post_app_messages_create
      parameters:
        -
          name: post
          in: path
          description: 'ID du post'
          required: true
          schema:
            type: integer
            pattern: '\d*'
      requestBody:
        description: 'Contenu du message'
        required: true
        content:
          application/json:
            schema:
              required:
                - text
                - utilisateurId
              properties:
                text:
                  type: string
                utilisateurId:
                  type: integer
              type: object
      responses:
        '201':
          description: 'Message créé'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponseDTO'
        '400':
          description: 'Paramètres manquants ou invalides'
  '/api/messages/{message}':
    delete:
      tags:
        - Message
      summary: 'Supprimer un message'
      description: 'Supprime un message par son ID'
      operationId: delete_app_messages_delete
      parameters:
        -
          name: message
          in: path
          description: 'ID du message'
          required: true
          schema:
            type: integer
            pattern: '\d*'
      responses:
        '204':
          description: 'Message supprimé avec succès'
        '404':
          description: 'Message non trouvé'
  '/api/post/{forum}/posts':
    get:
      tags:
        - Post
      summary: "Liste des posts d'un forum"
      description: 'Retourne la liste des posts pour un forum donné'
      operationId: get_app_post_forum_posts
      parameters:
        -
          name: forum
          in: path
          description: 'ID du forum'
          required: true
          schema:
            type: integer
            pattern: '\d*'
      responses:
        '200':
          description: 'Liste des posts'
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PostResponseDTO'
  '/api/post/{post}':
    put:
      tags:
        - Post
      summary: 'Mettre à jour un post'
      description: 'Met à jour un post existant'
      operationId: put_app_post_update_post
      parameters:
        -
          name: post
          in: path
          description: 'ID du post'
          required: true
          schema:
            type: integer
            pattern: '\d*'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              properties:
                epingle:
                  type: boolean
                  example: true
              type: object
      responses:
        '200':
          description: 'Post mis à jour avec succès'
          content:
            application/json:
              schema:
                properties:
                  message: { type: string, example: 'Post mis à jour avec succès' }
                type: object
        '500':
          description: 'Erreur lors de la mise à jour'
          content:
            application/json:
              schema:
                properties:
                  error: { type: string, example: "Message d'erreur" }
                type: object
    delete:
      tags:
        - Post
      summary: 'Supprimer un post'
      description: 'Supprime un post par son ID'
      operationId: delete_app_post_remove_post
      parameters:
        -
          name: post
          in: path
          description: 'ID du post'
          required: true
          schema:
            type: integer
            pattern: '\d*'
      responses:
        '200':
          description: 'Post supprimé avec succès'
          content:
            application/json:
              schema:
                properties:
                  message: { type: string, example: 'Post supprimé avec succès' }
                type: object
  /api/post/:
    post:
      tags:
        - Post
      summary: 'Créer un post'
      description: 'Crée un nouveau post dans un forum'
      operationId: post_app_post_create_post
      requestBody:
        required: true
        content:
          application/json:
            schema:
              properties:
                titre:
                  type: string
                  example: 'Titre du post'
                utilisateur:
                  type: integer
                  example: 1
                forum:
                  type: integer
                  example: 1
              type: object
      responses:
        '200':
          description: 'Post créé avec succès'
          content:
            application/json:
              schema:
                properties:
                  message: { type: string, example: 'Post créé avec succès' }
                type: object
  /api/tokens/refresh:
    post:
      tags:
        - 'JWT Tokens'
      summary: 'Rafraîchir un token JWT'
      description: "Génère un nouveau token d'accès à partir d'un refresh token valide"
      operationId: refreshToken
      requestBody:
        description: 'Refresh token à utiliser'
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TokenRefreshRequestDTO'
      responses:
        '200':
          description: 'Token rafraîchi avec succès'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokenRefreshResponseDTO'
        '400':
          description: 'Refresh token invalide ou expiré'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseDTO'
  /api/tokens/validate:
    post:
      tags:
        - 'JWT Tokens'
      summary: 'Valider un token JWT'
      description: "Vérifie la validité d'un token JWT et retourne ses informations."
      operationId: validateToken
      requestBody:
        description: 'Token à valider'
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TokenValidationRequestDTO'
      responses:
        '200':
          description: 'Token valide'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokenValidationResponseDTO'
        '400':
          description: 'Token invalide'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokenValidationResponseDTO'
  /api/tokens/info:
    get:
      tags:
        - 'JWT Tokens'
      summary: "Obtenir les informations d'un token JWT"
      description: 'Retourne les informations détaillées du token JWT transmis via cookie ou header.'
      operationId: getTokenInfo
      responses:
        '200':
          description: 'Informations du token'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokenInfoResponseDTO'
        '401':
          description: 'Token manquant ou invalide'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseDTO'
        '500':
          description: 'Erreur serveur'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponseDTO'
  /api/me:
    get:
      tags:
        - User
      summary: "Récupérer les informations de l'utilisateur actuel"
      description: "Retourne les informations de profil de l'utilisateur authentifié"
      operationId: get_app_api_me
      responses:
        '200':
          description: 'Informations utilisateur récupérées avec succès'
          content:
            application/json:
              schema:
                properties:
                  id: { description: "Identifiant unique de l'utilisateur", type: integer, example: 1 }
                  username: { description: "Nom d'utilisateur", type: string, example: john_doe }
                  roles: { description: "Liste des rôles de l'utilisateur", type: array, items: { type: string }, example: [ROLE_USER] }
                  lastVisit: { description: 'Date et heure de la dernière visite', type: string, format: date-time, example: '2025-07-01 10:30:00' }
                type: object
        '401':
          description: 'Utilisateur non authentifié'
          content:
            application/json:
              schema:
                properties:
                  error: { description: "Code d'erreur", type: string, example: UNAUTHORIZED }
                  message: { description: "Message d'erreur", type: string, example: 'User not authenticated' }
                type: object
    options:
      tags:
        - User
      operationId: options_app_api_me_options
      responses:
        default:
          description: ''
components:
  schemas:
    CsrfTokenResponseDTO:
      title: 'Réponse de génération de token CSRF'
      description: "Structure de la réponse lors de la génération d'un token CSRF"
      required:
        - csrfToken
      properties:
        csrfToken:
          description: 'Le token CSRF généré'
          type: string
          example: abc123def456ghi789
      type: object
    ErrorResponseDTO:
      required:
        - error
      properties:
        error:
          type: string
        message:
          type: string
          default: null
          nullable: true
        code:
          type: integer
          default: null
          nullable: true
        details:
          type: array
          items: {  }
          default: null
          nullable: true
      type: object
    CsrfTokenVerificationRequestDTO:
      required:
        - csrfToken
      properties:
        csrfToken:
          type: string
          maxLength: 128
          minLength: 16
          pattern: '[a-zA-Z0-9_-]+'
      type: object
    CsrfTokenVerificationResponseDTO:
      required:
        - valid
        - message
      properties:
        valid:
          type: boolean
        message:
          type: string
      type: object
    CategorieForumResponseDTO:
      description: 'Catégorie de forum'
      required:
        - id
        - name
        - ordre
      properties:
        id:
          description: 'ID de la catégorie'
          type: integer
          example: 1
        name:
          description: 'Nom de la catégorie'
          type: string
          example: Général
        ordre:
          description: "Ordre d'affichage"
          type: integer
          example: 1
      type: object
    ForumResponseDTO:
      description: Forum
      required:
        - id
        - titre
        - dateCreation
        - description
        - ordreAffichage
        - visible
        - slug
        - createdAt
      properties:
        id:
          type: integer
          example: 1
        titre:
          type: string
          example: 'Forum général'
        dateCreation:
          type: string
          format: date-time
          example: '2025-07-27T10:00:00'
        description:
          type: string
          example: 'Description du forum'
        ordreAffichage:
          type: integer
          example: 1
        visible:
          type: boolean
          example: true
        slug:
          type: string
          example: forum-general
        createdAt:
          type: string
          format: date-time
          example: '2025-07-27T10:00:00'
      type: object
    ForumCreateRequestDTO:
      description: 'Forum creation request'
      required:
        - titre
        - categories
        - description
        - ordreAffichage
        - visible
        - utilisateur
      properties:
        titre:
          type: string
          example: 'Forum général'
        categories:
          type: integer
          example: 1
        description:
          type: string
          example: 'Description du forum'
        ordreAffichage:
          type: integer
          example: 1
        visible:
          type: boolean
          example: true
        utilisateur:
          type: integer
          example: 1
      type: object
    AzureUploadResponseDTO:
      title: "Réponse d'upload Azure"
      description: 'Informations pour uploader directement vers Azure Blob Storage'
      required:
        - upload_url
        - blob_name
        - expires_at
        - headers
        - expired
        - timeUntilExpiry
      properties:
        upload_url:
          description: "URL présignée pour l'upload"
          type: string
          example: 'https://storage.blob.core.windows.net/container/blob?sig=...'
        blob_name:
          description: 'Nom du blob dans Azure'
          type: string
          example: images/uuid-photo.jpg
        expires_at:
          description: "Date d'expiration de l'URL"
          type: string
          format: date-time
          example: '2025-06-29T15:30:00Z'
        headers:
          description: "Headers requis pour l'upload"
          type: object
          example:
            x-ms-blob-type: BlockBlob
            Content-Type: image/jpeg
        expired:
          title: "Vérifie si l'URL d'upload est encore valide."
          type: boolean
        timeUntilExpiry:
          title: 'Retourne le temps restant avant expiration en secondes.'
          type: integer
      type: object
    JWTLoginResponseDTO:
      required:
        - success
        - message
        - user
        - tokens
      properties:
        success:
          title: 'Crée un DTO de succès avec tokens JWT.'
          type: boolean
        message:
          type: string
        user:
          $ref: '#/components/schemas/LoginUserDTO'
        tokens:
          type: array
          items: {  }
      type: object
    MachineResponseDTO:
      description: Machine
      required:
        - id
        - name
        - visible
        - image
        - description
        - forum
        - infoMachines
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: 'PC Portable'
        visible:
          type: boolean
          example: true
        image:
          type: string
          example: image.png
        description:
          type: string
          example: 'Ordinateur performant'
        forum:
          properties:
            id:
              type: integer
              example: 1
          type: object
        infoMachines:
          type: array
          items:
            properties:
              id:
                type: integer
                example: 1
              text:
                type: string
                example: 'RAM 16Go'
              type:
                type: string
                example: hardware
            type: object
      type: object
    MachineCreateRequestDTO:
      description: 'Machine creation request'
      required:
        - nom
        - image
        - infoMachines
      properties:
        nom:
          type: string
          example: 'PC Portable'
        image:
          type: string
          example: image.png
        infoMachines:
          type: array
          items:
            $ref: App\DTO\InfoMachineBaseDTO
      type: object
    MachineUpdateRequestDTO:
      description: 'Machine update request'
      required:
        - nom
        - image
        - description
        - infoMachines
      properties:
        nom:
          type: string
          example: 'PC Portable'
        image:
          type: string
          example: image.png
        description:
          type: string
          example: 'Ordinateur performant'
        infoMachines:
          type: array
          items:
            $ref: App\DTO\InfoMachineUpdateDTO
      type: object
    MessageResponseDTO:
      description: Message
      required:
        - id
        - text
        - dateCreation
        - dateModification
        - visible
        - utilisateur
      properties:
        id:
          type: integer
          example: 1
        text:
          type: string
          example: 'Ceci est un message'
        dateCreation:
          type: string
          format: date-time
          example: '2025-07-27T10:00:00'
        dateModification:
          type: string
          format: date-time
          example: '2025-07-27T10:05:00'
        visible:
          type: boolean
          example: true
        utilisateur:
          $ref: App\DTO\MessageUserResponseDTO
      type: object
    PostResponseDTO:
      description: Post
      required:
        - id
        - titre
        - dateCreation
        - vues
        - epingle
        - verrouille
        - messages
      properties:
        id:
          type: integer
          example: 1
        titre:
          type: string
          example: 'Titre du post'
        dateCreation:
          type: string
          format: date-time
          example: '2025-07-27 10:00:00'
        vues:
          type: integer
          example: 42
        epingle:
          type: boolean
          example: false
        verrouille:
          type: boolean
          example: false
        messages:
          type: array
          items:
            $ref: App\DTO\MessageResponseDTO
      type: object
    TokenRefreshRequestDTO:
      required:
        - refreshToken
        - validFormat
      properties:
        refreshToken:
          type: string
          maxLength: 2048
          minLength: 50
        validFormat:
          type: boolean
      type: object
    TokenRefreshResponseDTO:
      required:
        - success
        - message
        - tokens
      properties:
        success:
          title: 'Crée une réponse de succès pour le refresh.'
          type: boolean
        message:
          type: string
        tokens:
          $ref: '#/components/schemas/JWTTokensDTO'
      type: object
    TokenValidationRequestDTO:
      required:
        - token
        - validFormat
      properties:
        token:
          type: string
          maxLength: 2048
          minLength: 50
        validFormat:
          type: boolean
      type: object
    TokenValidationResponseDTO:
      required:
        - valid
      properties:
        valid:
          title: 'Crée un DTO pour un token valide.'
          type: boolean
        tokenId:
          type: string
          default: null
          nullable: true
        userId:
          type: string
          default: null
          nullable: true
        username:
          type: string
          default: null
          nullable: true
        tokenType:
          type: string
          default: null
          nullable: true
        issuedAt:
          type: string
          nullable: true
        expiresAt:
          type: string
          default: null
          nullable: true
        roles:
          type: array
          items: {  }
          default: null
          nullable: true
        error:
          type: string
          default: null
          nullable: true
      type: object
    TokenInfoResponseDTO:
      required:
        - valid
        - stillValid
      properties:
        valid:
          type: boolean
        tokenId:
          type: string
          default: null
          nullable: true
        userId:
          type: string
          default: null
          nullable: true
        username:
          type: string
          default: null
          nullable: true
        tokenType:
          type: string
          default: null
          nullable: true
        issuedAt:
          type: string
          nullable: true
        expiresAt:
          type: string
          default: null
          nullable: true
        roles:
          type: array
          items: {  }
          default: null
          nullable: true
        issuer:
          type: string
          nullable: true
        audience:
          type: string
          default: null
          nullable: true
        loginTime:
          type: integer
          default: null
          nullable: true
        ipAddress:
          type: string
          default: null
          nullable: true
        userAgent:
          type: string
          default: null
          nullable: true
        error:
          type: string
          default: null
          nullable: true
        stillValid:
          title: 'Vérifie si le token est encore valide (non expiré).'
          type: boolean
        timeUntilExpiration:
          title: 'Obtient le temps restant avant expiration en secondes.'
          type: integer
          nullable: true
      type: object
    LoginUserDTO:
      title: 'Informations utilisateur'
      description: "Données utilisateur dans les réponses d'authentification"
      required:
        - id
        - username
        - roles
      properties:
        id:
          description: "Identifiant unique de l'utilisateur"
          type: integer
          example: 1
        username:
          description: "Nom d'utilisateur"
          type: string
          example: john.doe
        roles:
          description: "Liste des rôles de l'utilisateur"
          type: array
          items:
            type: string
          example:
            - ROLE_USER
        last_visit:
          description: 'Date et heure de la dernière visite'
          type: string
          format: date-time
          default: null
          example: '2025-06-29 14:30:00'
          nullable: true
      type: object
    JWTTokensDTO:
      required:
        - accessToken
        - refreshToken
        - tokenType
        - expiresIn
        - valid
        - authorizationHeader
      properties:
        accessToken:
          type: string
        refreshToken:
          type: string
        tokenType:
          type: string
        expiresIn:
          type: integer
        refreshExpiresIn:
          type: integer
          default: null
          nullable: true
        valid:
          title: 'Valide la structure des tokens.'
          type: boolean
        authorizationHeader:
          title: "Obtient uniquement le token d'accès pour les headers Authorization."
          type: string
      type: object
  securitySchemes:
    bearerAuth:
      type: http
      description: "Token JWT d'authentification"
      bearerFormat: JWT
      scheme: bearer
    csrfToken:
      type: apiKey
      description: 'Token CSRF pour la protection contre les attaques CSRF'
      name: X-CSRF-Token
      in: header
security:
  -
    bearerAuth: []
  -
    csrfToken: []
tags:
  -
    name: Authentication
    description: "Gestion de l'authentification utilisateur"
  -
    name: 'CSRF Token'
    description: 'Gestion des tokens CSRF'
  -
    name: 'JWT Tokens'
    description: 'Gestion des tokens JWT (refresh, validation, révocation)'
  -
    name: Images
    description: 'Gestion des images via Azure Blob Storage'
  -
    name: CategorieForum
    description: 'Gestion des catégories de forum'
  -
    name: Forum
    description: 'Gestion des forums'
  -
    name: Health
    description: 'Endpoints de vérification de santé'
  -
    name: 'Admin Login Logs'
    description: "Endpoints d'administration pour les statistiques et blocages de connexion"
  -
    name: Machine
    description: 'Endpoints pour la gestion des machines'
  -
    name: Message
    description: 'Gestion des messages'
  -
    name: User
    description: 'Gestion des utilisateurs'
  -
    name: Post
    description: Post

